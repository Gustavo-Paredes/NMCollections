{% extends 'base/base.html' %}
{% load static %}

{% block title %}Editar Plantilla: {{ plantilla.nombre }} - Panel de Diseñador{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}


{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-main-card admin-section">
        <div class="dashboard-header">
            <h1><i class="fas fa-edit"></i> Editar Plantilla: {{ plantilla.nombre }}</h1>
            <p>Modifica las propiedades de la plantilla</p>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-card-inner" style="width:100%;">
                <form method="post" enctype="multipart/form-data" id="plantillaForm">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="{{ form.nombre.id_for_label }}">
                                    <i class="fas fa-tag"></i> Nombre de la Plantilla *
                                </label>
                                {{ form.nombre }}
                                {% if form.nombre.errors %}
                                    <div class="text-danger">{{ form.nombre.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="form-group mb-3">
                                <label for="{{ form.tipo_carta.id_for_label }}">
                                    <i class="fas fa-layer-group"></i> Tipo de Carta
                                </label>
                                {{ form.tipo_carta }}
                                <div class="help-text">Ej: pokemon, yugioh, magic, etc.</div>
                                {% if form.tipo_carta.errors %}
                                    <div class="text-danger">{{ form.tipo_carta.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="form-group mb-3">
                                <label for="{{ form.diseñador.id_for_label }}">
                                    <i class="fas fa-user"></i> Diseñador
                                </label>
                                {{ form.diseñador }}
                                {% if form.diseñador.errors %}
                                    <div class="text-danger">{{ form.diseñador.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="{{ form.imagen_marco.id_for_label }}">
                                    <i class="fas fa-image"></i> Imagen de Marco/Fondo
                                </label>
                                {{ form.imagen_marco }}
                                <div class="help-text">Deja en blanco para mantener la imagen actual</div>
                                {% if form.imagen_marco.errors %}
                                    <div class="text-danger">{{ form.imagen_marco.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="preview-area" id="imagePreview">
                                {% if plantilla.imagen_marco %}
                                    <img src="{{ plantilla.imagen_marco.url }}" alt="{{ plantilla.nombre }}" class="preview-image">
                                {% else %}
                                    <div class="text-muted">
                                        <i class="fas fa-image fa-3x"></i>
                                        <p class="mt-2">Sin imagen actual</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="dimension-group">
                        <h5><i class="fas fa-expand-arrows-alt"></i> Dimensiones del Marco</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.ancho_marco.id_for_label }}">Ancho (px)</label>
                                    {{ form.ancho_marco }}
                                    {% if form.ancho_marco.errors %}
                                        <div class="text-danger">{{ form.ancho_marco.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.alto_marco.id_for_label }}">Alto (px)</label>
                                    {{ form.alto_marco }}
                                    {% if form.alto_marco.errors %}
                                        <div class="text-danger">{{ form.alto_marco.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-4">
                        <label for="{{ form.descripcion.id_for_label }}">
                            <i class="fas fa-align-left"></i> Descripción
                        </label>
                        {{ form.descripcion }}
                        <div class="help-text">Describe el propósito y características de esta plantilla</div>
                        {% if form.descripcion.errors %}
                            <div class="text-danger">{{ form.descripcion.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="text-center">
                        <a href="{% url 'personalizacion:panel_diseñador' %}" class="btn-dashboard admin-btn me-3">
                            <i class="fas fa-arrow-left"></i> Volver al Panel
                        </a>
                        <button type="submit" class="btn-dashboard admin-btn">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="dashboard-grid" style="margin-top:2rem;">
            <div class="dashboard-card-inner" style="width:100%;">
                <div class="elements-container">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-puzzle-piece"></i> Elementos de la Plantilla</h3>
                        <a href="{% url 'personalizacion:agregar_elemento' plantilla.id %}" class="btn-dashboard admin-btn">
                            <i class="fas fa-plus"></i> Agregar Elemento
                        </a>
                    </div>
                    {% for elemento in elementos %}
                    <div class="element-card">
                        <div class="element-header">
                            <div>
                                <h5 class="mb-1">{{ elemento.nombre_parametro }}</h5>
                                <span class="element-type-badge">
                                    <i class="fas fa-{% if elemento.tipo_elemento == 'texto' %}font{% elif elemento.tipo_elemento == 'imagen' %}image{% elif elemento.tipo_elemento == 'color' %}palette{% else %}hashtag{% endif %}"></i>
                                    {{ elemento.get_tipo_elemento_display }}
                                </span>
                            </div>
                            <div>
                                <a href="{% url 'personalizacion:eliminar_elemento' elemento.id %}" class="btn btn-outline-danger btn-sm">
                                    <i class="fas fa-trash"></i> Eliminar
                                </a>
                            </div>
                        </div>
                        <div class="row element-info">
                            <div class="col-md-3">
                                <strong>Posición:</strong><br>
                                X: {{ elemento.posicion_x|default:"No definido" }}px<br>
                                Y: {{ elemento.posicion_y|default:"No definido" }}px
                            </div>
                            <div class="col-md-3">
                                <strong>Tamaño:</strong><br>
                                Ancho: {{ elemento.ancho|default:"Auto" }}px<br>
                                Alto: {{ elemento.alto|default:"Auto" }}px
                            </div>
                            <div class="col-md-3">
                                <strong>Estilo:</strong><br>
                                Fuente: {{ elemento.fuente|default:"Por defecto" }}<br>
                                Color: {{ elemento.color|default:"Sin definir" }}
                            </div>
                            <div class="col-md-3">
                                <strong>Z-Index:</strong><br>
                                {{ elemento.z_index|default:"Auto" }}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-puzzle-piece fa-3x mb-3"></i>
                        <h4>No hay elementos configurados</h4>
                        <p>Agrega elementos para que los usuarios puedan personalizar la carta</p>
                        <a href="{% url 'personalizacion:agregar_elemento' plantilla.id %}" class="btn-dashboard admin-btn">
                            <i class="fas fa-plus"></i> Agregar Primer Elemento
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Preview de imagen
    const imageInput = document.getElementById('{{ form.imagen_marco.id_for_label }}');
    const previewArea = document.getElementById('imagePreview');
    
    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewArea.innerHTML = `<img src="${e.target.result}" alt="Preview" class="preview-image">`;
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Animación de entrada
    const containers = document.querySelectorAll('.form-container, .elements-container');
    containers.forEach((container, index) => {
        container.style.opacity = '0';
        container.style.transform = 'translateY(20px)';
        setTimeout(() => {
            container.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            container.style.opacity = '1';
            container.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}