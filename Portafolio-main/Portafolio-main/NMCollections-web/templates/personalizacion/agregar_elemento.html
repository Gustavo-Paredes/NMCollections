{% extends 'base/base.html' %}
{% load static %}

{% block title %}Agregar Elemento - {{ plantilla.nombre }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-main-card admin-section">
        <div class="dashboard-header">
            <h1><i class="fas fa-plus-circle"></i> Agregar Elemento</h1>
            <p>Plantilla: <strong>{{ plantilla.nombre }}</strong></p>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-card-inner" style="width:100%;">
                <form method="post" id="elementoForm">
                    {% csrf_token %}
                    <div class="dashboard-section">
                        <h4 class="dashboard-section-title"><i class="fas fa-info-circle"></i> Información Básica</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.nombre_parametro.id_for_label }}">
                                        <i class="fas fa-tag"></i> Nombre del Parámetro *
                                    </label>
                                    {{ form.nombre_parametro }}
                                    <div class="help-text">Ej: nombre_jugador, ataque, descripcion</div>
                                    {% if form.nombre_parametro.errors %}
                                        <div class="text-danger">{{ form.nombre_parametro.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.tipo_elemento.id_for_label }}">
                                        <i class="fas fa-layer-group"></i> Tipo de Elemento *
                                    </label>
                                    {{ form.tipo_elemento }}
                                    <div class="help-text">Define qué tipo de contenido manejará</div>
                                    {% if form.tipo_elemento.errors %}
                                        <div class="text-danger">{{ form.tipo_elemento.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="elemento-preview" id="tipoPreview">
                            <div class="text-muted">
                                <div class="tipo-icon" id="tipoIcon">
                                    <i class="fas fa-question"></i>
                                </div>
                                <p>Selecciona un tipo para ver la vista previa</p>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-section">
                        <h4 class="dashboard-section-title"><i class="fas fa-expand-arrows-alt"></i> Posición y Tamaño</h4>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label for="{{ form.posicion_x.id_for_label }}">Posición X (px)</label>
                                    {{ form.posicion_x }}
                                    <div class="help-text">Distancia desde la izquierda</div>
                                    {% if form.posicion_x.errors %}
                                        <div class="text-danger">{{ form.posicion_x.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label for="{{ form.posicion_y.id_for_label }}">Posición Y (px)</label>
                                    {{ form.posicion_y }}
                                    <div class="help-text">Distancia desde arriba</div>
                                    {% if form.posicion_y.errors %}
                                        <div class="text-danger">{{ form.posicion_y.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label for="{{ form.ancho.id_for_label }}">Ancho (px)</label>
                                    {{ form.ancho }}
                                    <div class="help-text">Ancho del elemento</div>
                                    <div class="help-text">ancho recomendado para fotos (250px)</div>
                                    {% if form.ancho.errors %}
                                        <div class="text-danger">{{ form.ancho.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-3">
                                    <label for="{{ form.alto.id_for_label }}">Alto (px)</label>
                                    {{ form.alto }}
                                    <div class="help-text">Alto del elemento</div>
                                    <div class="help-text">ancho recomendado para fotos (300px)</div>
                                    {% if form.alto.errors %}
                                        <div class="text-danger">{{ form.alto.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-section">
                        <h4 class="dashboard-section-title"><i class="fas fa-paint-brush"></i> Estilo</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="{{ form.fuente.id_for_label }}">
                                        <i class="fas fa-font"></i> Fuente
                                    </label>
                                    {{ form.fuente }}
                                    <div id="font-sample" style="margin-top:10px; font-size:1.2em;">Texto de ejemplo</div>
                                    <div class="help-text">Ej: Arial, Helvetica, sans-serif</div>
                                    {% if form.fuente.errors %}
                                        <div class="text-danger">{{ form.fuente.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="{{ form.color.id_for_label }}">
                                        <i class="fas fa-palette"></i> Color
                                    </label>
                                    {{ form.color }}
                                    <div class="help-text">Color del texto o elemento</div>
                                    {% if form.color.errors %}
                                        <div class="text-danger">{{ form.color.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="{{ form.z_index.id_for_label }}">
                                        <i class="fas fa-layer-group"></i> Z-Index
                                    </label>
                                    {{ form.z_index }}
                                    <div class="help-text">Orden de superposición</div>
                                    {% if form.z_index.errors %}
                                        <div class="text-danger">{{ form.z_index.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center" style="margin-top:2rem;">
                        <a href="{% url 'personalizacion:editar_plantilla' plantilla.id %}" class="btn-dashboard admin-btn me-3">
                            <i class="fas fa-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn-dashboard admin-btn">
                            <i class="fas fa-save"></i> Agregar Elemento
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Vista previa de fuente
    const fuenteSelect = document.getElementById('id_fuente');
    const fontSample = document.getElementById('font-sample');
    function updateFontSample() {
        if (fuenteSelect && fontSample) {
            fontSample.style.fontFamily = fuenteSelect.value;
        }
    }
    if (fuenteSelect) {
        fuenteSelect.addEventListener('change', updateFontSample);
        updateFontSample();
    }
    const tipoSelect = document.getElementById('{{ form.tipo_elemento.id_for_label }}');
    const tipoIcon = document.getElementById('tipoIcon');
    const tipoPreview = document.getElementById('tipoPreview');
    
    // Mapeo de tipos a iconos y descripciones
    const tipoMap = {
        'texto': {
            icon: 'fas fa-font',
            desc: 'Elemento de texto personalizable',
            example: 'Ej: Nombre del jugador, descripción'
        },
        'imagen': {
            icon: 'fas fa-image', 
            desc: 'Elemento de imagen personalizable',
            example: 'Ej: Foto del jugador, logo'
        },
        'color': {
            icon: 'fas fa-palette',
            desc: 'Elemento de color personalizable', 
            example: 'Ej: Color de fondo, borde'
        },
        'numero': {
            icon: 'fas fa-hashtag',
            desc: 'Elemento numérico personalizable',
            example: 'Ej: Puntos de ataque, nivel'
        }
    };
    
    function actualizarPreview() {
        const tipo = tipoSelect.value;
        if (tipo && tipoMap[tipo]) {
            const info = tipoMap[tipo];
            tipoPreview.innerHTML = `
                <div>
                    <div class="tipo-icon">
                        <i class="${info.icon}"></i>
                    </div>
                    <h5>${info.desc}</h5>
                    <p class="text-muted">${info.example}</p>
                </div>
            `;
        } else {
            tipoPreview.innerHTML = `
                <div class="text-muted">
                    <div class="tipo-icon">
                        <i class="fas fa-question"></i>
                    </div>
                    <p>Selecciona un tipo para ver la vista previa</p>
                </div>
            `;
        }
    }
    
    // Actualizar preview al cambiar tipo
    tipoSelect.addEventListener('change', actualizarPreview);
    
    // Inicializar preview
    actualizarPreview();
    
    // Validación de formulario
    document.getElementById('elementoForm').addEventListener('submit', function(e) {
        const nombre = document.getElementById('{{ form.nombre_parametro.id_for_label }}').value;
        const tipo = document.getElementById('{{ form.tipo_elemento.id_for_label }}').value;
        
        if (!nombre.trim()) {
            e.preventDefault();
            alert('Por favor ingresa un nombre para el parámetro');
            return;
        }
        
        if (!tipo) {
            e.preventDefault();
            alert('Por favor selecciona un tipo de elemento');
            return;
        }
    });
    
    // Animación de entrada
    const container = document.querySelector('.form-container');
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    setTimeout(() => {
        container.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        container.style.opacity = '1';
        container.style.transform = 'translateY(0)';
    }, 100);
});
</script>
{% endblock %}