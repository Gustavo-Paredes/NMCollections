
{% extends "base/base.html" %}
{% load static %}

{% block title %}Mis Pedidos - NM Collections{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pedidos_mis_pedidos.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-header mb-4">

    </div>
    <div class="dashboard-main-card">
        <div class="dashboard-card-inner">
            {% if pedidos %}
                <div class="pedidos-grid-2">
                    {% for pedido in pedidos %}
                    <div class="pedido-card">
                        <div class="pedido-head">
                            <span class="pedido-num">#{{ pedido.numero_pedido }}</span>
                            {% if pedido.estado == 'pendiente' %}
                                <span class="badge-estado badge-pendiente">Pendiente</span>
                            {% elif pedido.estado == 'confirmado' %}
                                <span class="badge-estado badge-confirmado">Confirmado</span>
                            {% elif pedido.estado == 'enviado' %}
                                <span class="badge-estado badge-enviado">Enviado</span>
                            {% elif pedido.estado == 'entregado' %}
                                <span class="badge-estado badge-entregado">Entregado</span>
                            {% elif pedido.estado == 'cancelado' %}
                                <span class="badge-estado badge-cancelado">Cancelado</span>
                            {% endif %}
                        </div>
                        <div class="pedido-meta">
                            <div class="meta-item"><i class="fas fa-calendar me-2"></i><strong>Fecha:</strong> {{ pedido.fecha_pedido|date:"d/m/Y H:i" }}</div>
                            <div class="meta-item"><i class="fas fa-credit-card me-2"></i><strong>Método:</strong> {{ pedido.metodo_pago|upper }}</div>
                            <div class="meta-item"><i class="fas fa-money-bill me-2"></i><strong>Total:</strong> ${{ pedido.total|floatformat:0 }}</div>
                            <div class="meta-item"><i class="fas fa-boxes me-2"></i><strong>Ítems:</strong> {{ pedido.productos.count }}</div>
                        </div>
                        <div class="pedido-items">
                            <div class="mb-2"><strong>Productos</strong></div>
                            {% for item in pedido.productos.all|slice:":3" %}
                                <div class="item-row">
                                    <i class="fas fa-box"></i>
                                    {{ item.cantidad }}x {{ item.producto.nombre }}
                                </div>
                            {% endfor %}
                            {% if pedido.productos.count > 3 %}
                                <div class="item-row"><small>y {{ pedido.productos.count|add:"-3" }} más...</small></div>
                            {% endif %}
                        </div>
                        <div class="pedido-actions">
                            <a href="{% url 'pedidos:detalle_pedido' pedido.numero_pedido %}" class="btn btn-sm btn-dashboard flex-fill">
                                <i class="fas fa-eye me-2"></i>Ver Detalle
                            </a>
                            {% if pedido.estado == 'pendiente' %}
                            <form method="post" action="{% url 'pedidos:cancelar_pedido_usuario' pedido.id %}" class="flex-fill" onsubmit="return confirm('¿Estás seguro de cancelar este pedido?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-danger w-100">
                                    <i class="fas fa-times me-2"></i>Cancelar
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="dashboard-main-card p-4 text-center pedidos-empty">
                    <i class="fas fa-info-circle fa-3x mb-3"></i>
                    <h4>No tienes pedidos aún</h4>
                    <p>Explora nuestro catálogo y realiza tu primera compra</p>
                    <a href="{% url 'core:catalogo' %}" class="btn btn-dashboard mt-2">
                        <i class="fas fa-shopping-cart me-2"></i>Ir al Catálogo
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
